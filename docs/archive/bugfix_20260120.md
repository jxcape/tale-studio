# 버그 수정 상세 내역 (2026-01-20)

> Archive from PROGRESS.md

## 수정 전 문제점 (pipeline_output/20260120_205109)

**Scene 1 narrative_summary:**
> "Panoramic shot of a desolate battlefield at twilight. Thousands of fallen soldiers litter the field. Focus on a single, young warrior standing amidst the carnage."

**Shot 1:**
- `character_ids: []` → 비어있음
- `character_prompts: []` → 캐릭터 외형 정보 누락
- 원작의 "에스더", "루테란", "패자의 검" 등 구체적 명칭 손실

## 버그별 수정 내용

| 버그 | 파일 | 수정 전 | 수정 후 |
|------|------|---------|---------|
| BUG-001 | `usecases/scene_architect.py:65` | "Brief description of what happens" | "Detailed description preserving emotional tone, specific imagery, character names, dialogue, and key visual elements" |
| BUG-001 | `usecases/scene_architect.py:68` | - | `original_text` 필드 추가 (원작 인용) |
| BUG-002 | `usecases/shot_composer.py:139` | `narrative`만 전달 | `original_text` 필드도 전달 |
| BUG-003 | `usecases/scene_architect.py:196` | - | Character ID 목록 프롬프트에 명시 |
| BUG-004 | `domain/entities/prompt.py:94` | 전체 요소 포함 | `compact=True`, `max_length=400` 기본값 |

## 수정 후 예상 결과

**Scene narrative_summary:**
> "황폐한 전장의 파노라마. 황혼녘, 수천 명의 전사자들이 널려 있다. 루테란이 시체들 사이에 홀로 서 있다. 그의 금빛 갑옷이 석양빛에 붉게 물든다."

**original_text:**
> "패자의 검 - 에스더 갈라투르가 만들어준 전설의 무기. 그 검을 천천히 자신 앞에 세운다."

**Shot character_ids:**
```json
["lutheran"]  // 수정 전: []
```

**character_prompts:**
```json
["금색 정교한 갑옷에 파란 망토, 사자 문양의 어깨 장식. 패자의 검(금빛으로 빛나는 대검). 짧은 검은 머리에 회색 가닥, 풍파를 겪은 얼굴, 결연한 눈빛."]
// 수정 전: []
```

## 검증 결과 (2026-01-21)

- 파이프라인 재실행 성공 (pipeline_output/20260121_192652/)
- 3 scenes → 13 shots → 13 prompts 생성 확인
- APIKeyPool 통합으로 429 자동 failover 동작 확인
