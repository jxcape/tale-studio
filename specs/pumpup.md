# 펌프업 스펙

> 최종 수정: 2026-01-23 14:30
> 상태: 구현 준비 완료

## 개요

짧은 스토리 입력에 **L1이 씬 분할하기 좋고, Veo가 시각화할 수 있는 정보**를 추가.

**핵심**: 서사 보존 + 시각화 정보 확장 (문학적 확장 X)

---

## 목적

1. **L1 입력 최적화**: 씬 분할에 필요한 구조적 정보 추가
2. **Veo 시각화 지원**: 영상 생성에 필요한 시각 정보 추가
3. **서사 보존**: 고유명사, 핵심 대사, 인과관계 유지

---

## 파이프라인 위치

```
Story Input → [Pumpup] → Expanded Story → L1 → L2 → L3 → Veo
                ↑
            여기서 시각화 정보 추가
```

### 왜 필요한가?

L1 프롬프트가 추출하는 것:
- `narrative`: scene summary
- `location`: 장소
- `original_text`: 원문 인용

**원본 스토리에 없으면 L1도 못 뽑음** → 펌프업이 미리 추가

---

## 범위

### In Scope (펌프업이 추가)

| 카테고리 | 설명 | 예시 |
|----------|------|------|
| **시간/조명** | 시간대, 광원, 빛 방향 | "황혼녘", "석양빛이 비스듬히 내리쬐는" |
| **장소 구체화** | 공간 규모, 배경 요소, 지면 | "시체가 널린 피로 물든 평원" |
| **물리적 동작** | 속도, 방향, 신체 부위 | "천천히 검을 들어올렸다" |
| **환경 디테일** | 공기, 날씨, 분위기 요소 | "바람에 나부끼는 망토", "공중의 먼지" |

### Out of Scope (펌프업이 하지 않음)

| 카테고리 | 이유 | 처리 위치 |
|----------|------|----------|
| **감정→시각 표현** | 캐릭터성에 따라 표현 방식이 달라짐 | 추후 별도 시스템 |
| **캐릭터성 반영** | 맥락 의존적, 룰 기반 불가 | L2 또는 상위 레벨 |
| **캐릭터 내면** | "가슴 속 분노" 등 Veo가 못 그림 | 제외 |

---

## 보존 규칙

### MUST PRESERVE (반드시 보존)

| 요소 | 예시 |
|------|------|
| 고유명사 | 루테란, 아제나, 패자의 검 |
| 핵심 대사 | "이 싸움은 끝나지 않았다" |
| 인과관계 | A 때문에 B가 발생 |
| 전개 순서 | 사건의 시간순 |

### MUST NOT (금지)

- 원작에 없는 캐릭터 추가
- 스토리 전개 변경
- 원작 설정과 충돌하는 내용
- 감정의 내면 묘사 (Veo가 시각화 불가)

---

## 추가 정보 상세

### 1. 시간/조명 정보

L3가 조명을 결정하려면 시간대 힌트 필요.

```
입력: "전장에서 홀로 살아남았다"
추가: "황혼이 내려앉은 전장" / "석양빛이 비스듬히 내리쬐는"
```

포함할 것:
- 시간대: 새벽, 아침, 낮, 황혼, 밤
- 광원: 태양, 달, 횃불, 불빛
- 빛 방향: 역광, 측광, 정면광 (자연스럽게)

### 2. 장소 구체화

L1이 location 필드를 채우려면 구체적 장소 정보 필요.

```
입력: "전장"
추가: "시체가 널린 피로 물든 평원" / "한때 푸르렀던 평원은 핏빛으로 물들어"
```

포함할 것:
- 공간 규모: 좁은/넓은, 실내/야외
- 배경 요소: 하늘, 벽, 나무, 건물
- 지면/표면: 돌바닥, 잔디, 모래, 피

### 3. 물리적 동작

L2가 action_description을 채우려면 동작 구체화 필요.

```
입력: "검을 들어올린다"
추가: "천천히 검을 들어올렸다. 검날이 석양빛을 받아 빛났다."
```

포함할 것:
- 속도: 천천히, 급히, 갑자기
- 방향: 위로, 앞으로, 돌아서며
- 결과: 빛남, 소리, 움직임

### 4. 환경 디테일

Veo 프롬프트의 분위기 요소.

```
입력: (없음)
추가: "바람이 불어 망토가 나부꼈다" / "공중에 먼지가 떠다녔다"
```

포함할 것:
- 공기: 먼지, 안개, 연기
- 날씨: 바람, 비, 눈
- 움직이는 요소: 깃발, 나뭇잎, 불꽃

---

## 구현 설계

### 옵션 A: L1 전처리 (Pre-processor) ← 채택

```python
class StoryPumpup:
    async def expand(
        self,
        story: str,
        lore_context: Optional[str] = None,
        source_title: Optional[str] = None,  # 외부 레퍼런스 검색용
        target_length: int = 1500,  # 기본값 1500자
    ) -> str:
        """
        짧은 스토리에 시각화 정보 추가.

        Args:
            story: 원본 스토리 (100~500자)
            lore_context: 참조할 로어/설정 (optional)
            source_title: 원작 제목 (애니/게임 등 - 웹검색 컨텍스트용)
            target_length: 목표 글자수 (기본 1500, 범위 1500~2000)

        Returns:
            시각화 정보가 추가된 스토리 (1000~2500자)
        """
        pass
```

### 로어 컨텍스트 자동 주입

`source_title` 제공 시 웹검색으로 외부 레퍼런스 조회:

```python
async def _fetch_lore_context(self, source_title: str) -> str:
    """
    외부 레퍼런스(애니, 게임 등)에서 로어 정보 조회.

    검색 쿼리 예시:
    - "{source_title} 세계관 설정"
    - "{source_title} 캐릭터 설정"
    - "{source_title} lore wiki"

    Returns:
        검색 결과에서 추출한 핵심 설정 정보
    """
    pass
```

**활용 시나리오**:
- 로스트아크 → "로스트아크 세계관" 검색 → 아크라시아 대륙 설정 등 주입
- 게임/애니 원작 → 위키, 나무위키 등에서 설정 정보 추출
- 오리지널 → lore_context 직접 전달 or 생략

---

## 프롬프트 설계

```
당신은 영상 제작을 위한 스토리 확장 전문가입니다.
주어진 스토리에 영상 생성에 필요한 시각 정보를 추가하세요.

## 입력
- 원본 스토리: {story}
- 참조 로어: {lore_context}
- 목표 분량: {target_length}자

## 추가해야 할 정보 (우선순위 순)

1. 시간/조명: 시간대, 광원, 빛 방향
2. 장소 구체화: 공간 규모, 배경 요소, 지면
3. 물리적 동작: 속도, 방향, 결과
4. 환경 디테일: 공기, 날씨, 움직이는 요소

## 반드시 보존
- 모든 고유명사 (인명, 지명, 아이템명)
- 핵심 대사 (있으면 원문 그대로)
- 인과관계와 전개 순서

## 하지 말 것
- 캐릭터 추가
- 스토리 전개 변경
- 감정의 내면 묘사 ("가슴 속 분노" 등)
- 추상적 감정 단어 그대로 두기 → 시각 정보로 대체하지 말고 그냥 유지

## 출력
시각 정보가 추가된 스토리를 산문 형식으로 출력.
```

---

## 예시

### 입력 (150자)
```
루테란은 전장에서 홀로 살아남았다. 동료들의 시체 사이에 서서 패자의 검을
들어올린다. "이 싸움은 끝나지 않았다."
```

### 출력 (500자)
```
황혼이 내려앉은 전장에는 수천 구의 시체가 널려 있었다. 한때 푸르렀던
평원은 이제 핏빛으로 물들어 있었다. 석양빛이 비스듬히 내리쬐어 긴
그림자를 드리웠다.

그 한가운데, 루테란이 서 있었다. 바람이 불어와 그의 망토가 나부꼈다.
발밑에는 함께 싸웠던 동료들이 쓰러져 있었다.

천천히, 루테란은 패자의 검을 들어올렸다. 검날이 석양빛을 받아 금빛으로
빛났다. 검날에 맺힌 핏방울이 땅으로 떨어졌다.

"이 싸움은 끝나지 않았다."
```

### 추가된 정보 분석

| 카테고리 | 추가된 내용 |
|----------|-------------|
| 시간/조명 | "황혼", "석양빛이 비스듬히 내리쬐어", "긴 그림자" |
| 장소 | "수천 구의 시체가 널린", "핏빛으로 물든 평원" |
| 동작 | "천천히", "들어올렸다", "떨어졌다" |
| 환경 | "바람이 불어", "망토가 나부꼈다" |

### 제외된 것 (의도적)

- ~~"결연한 눈빛이 빛났다"~~ (감정 표현)
- ~~"가슴 속에서 타오르는 분노"~~ (내면 묘사)
- ~~"패배했지만 꺾이지 않은 자의 눈"~~ (캐릭터성)

---

## 검증 기준

| 항목 | 기준 | 측정 방법 |
|------|------|----------|
| 고유명사 보존 | 100% | 입력의 고유명사가 출력에 모두 존재 |
| 핵심 대사 보존 | 원문 그대로 | 따옴표 내용 일치 확인 |
| 시간/조명 정보 | 1개 이상 | 시간대 or 광원 언급 여부 |
| 장소 구체화 | 원본 대비 상세 | 배경 요소 추가 여부 |
| 동작 구체화 | 속도/방향 포함 | 부사/방향어 존재 여부 |
| 금지 항목 위반 | 0건 | 캐릭터 추가, 내면 묘사 없음 |

---

## 해결된 사항

- [x] 옵션 A vs B → **A (전처리) 채택**
- [x] 목표 분량 기본값 → **1500자** (범위 1500~2000)
- [x] 로어 컨텍스트 자동 주입 → **source_title로 웹검색** (외부 레퍼런스 있는 경우)
- [x] 감정 단어 처리 → **배제** (LLM 판단 로그만 남김)

### 감정 단어 처리 상세

- 펌프업 단계에서 감정 단어(예: "분노", "슬픔")는 **변환하지 않고 그대로 유지**
- LLM이 감정 단어를 시각 표현으로 어떻게 해석하는지 **로그로 기록**
- 추후 패턴 분석 후 별도 시스템 필요 여부 판단

```python
# 로그 예시
logger.info(f"[Pumpup] 감정 단어 감지: {detected_emotions}")
logger.info(f"[Pumpup] LLM 출력에서 감정 처리: {emotion_handling_summary}")
```

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-01-22 | 스펙 인터뷰 기반 초안 작성 |
| 2026-01-23 | 목적 재정의: "소설 확장" → "L1 입력 최적화 + 시각화 정보 추가" |
| 2026-01-23 | 범위 제한: 캐릭터성/감정선 제외 |
| 2026-01-23 | 미해결 사항 확정: 분량 1500자, 로어 웹검색, 감정 배제+로그 |
